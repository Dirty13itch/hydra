# HYDRA: Comprehensive Vision vs Reality Analysis
## Autonomous Work Backlog - December 18, 2025

> Generated by Claude Code (Opus 4.5) - Permanent Proactive Team Lead
> This document serves as the continuous work backlog for autonomous operation

---

## VISION STATEMENT

### What Shaun Wants Hydra To Be

Based on all conversations, requests, and the established CLAUDE.md directives, Hydra should be:

1. **A True AI Operating System** - Not just a collection of tools, but an intelligent system that:
   - Works autonomously 24/7 without constant human intervention
   - Monitors its own resources and adjusts workload accordingly
   - Self-heals when services fail
   - Self-improves based on learnings
   - Proactively identifies and completes work

2. **A Personal AI Assistant** - That can:
   - Understand and respond to voice commands ("Hey Jarvis")
   - Remember context across sessions
   - Learn preferences over time
   - Provide morning briefings
   - Manage home automation based on presence

3. **A Creative Production Pipeline** - For Empire of Broken Queens:
   - Upload a script chapter ‚Üí receive complete assets overnight
   - Character consistency across all generated images
   - Voice synthesis with distinct character personalities
   - Automated quality scoring and feedback loops
   - Package output for Ren'Py visual novel engine

4. **An Intelligent Research System** - That can:
   - Queue research tasks and complete them autonomously
   - Aggregate news and information from RSS feeds
   - Synthesize findings into actionable summaries
   - Build and maintain a knowledge base

5. **A Self-Aware Infrastructure** - With:
   - Real-time visibility into all 64+ containers
   - GPU utilization and temperature monitoring
   - Automatic resource allocation based on demand
   - Predictive maintenance and failure prevention

---

## REALITY CHECK: Current State

### What EXISTS and WORKS (Score: 85%)

| Component | Status | Details |
|-----------|--------|---------|
| **Hydra Tools API** | ‚úÖ v2.9.0 | 425+ endpoints, API key auth |
| **24/7 Scheduler** | ‚úÖ NEW | Resource-aware, Prometheus integrated |
| **Cluster Resource Monitor** | ‚úÖ NEW | All 4 GPUs tracked, 30s intervals |
| **GPU Dashboard** | ‚úÖ DONE | Prometheus metrics, Fahrenheit temps |
| **Command Center** | ‚úÖ Working | Mission, Infra, Knowledge pages |
| **Voice Pipeline** | ‚úÖ Working | Kokoro TTS (44ms), Whisper STT ready |
| **Character System** | ‚úÖ Complete | 22 queens with voice profiles |
| **Memory Architecture** | ‚úÖ Working | MIRIX 6-tier, Qdrant + Neo4j |
| **CrewAI Agents** | ‚úÖ Working | Monitoring, Research, Maintenance |
| **Homepage Integration** | ‚úÖ Complete | SSE streaming, 30 services |
| **Constitutional AI** | ‚úÖ Enforced | Protected containers, audit logs |
| **Sandbox Execution** | ‚úÖ Secure | Network isolated, read-only FS |

### What's MISSING or INCOMPLETE (Score: 15% gap)

| Component | Status | Gap Description |
|-----------|--------|-----------------|
| **24/7 Autonomous Work** | üîÑ 70% | Scheduler exists, needs more handlers |
| **Discord Notifications** | ‚ö†Ô∏è Config | Webhook URL not configured |
| **Home Assistant** | ‚ö†Ô∏è Config | HA_TOKEN not configured |
| **Wake Word** | ‚ö†Ô∏è Untested | "Hey Jarvis" endpoint exists |
| **Quality Scoring** | ‚ùå Missing | No CLIP comparison for images |
| **Human Feedback Loop** | ‚ùå Missing | No accept/reject UI |
| **Background Generation** | ‚ùå Missing | No scene background pipeline |
| **Model Hot-Swapping** | ‚ùå Missing | Manual restarts required |
| **Speculative Decoding** | ‚ö†Ô∏è Research | Hardware limited (needs GPU match) |
| **Presence Automations** | ‚ùå Missing | No leave/arrive triggers |
| **Morning Briefing** | üîÑ 50% | Endpoint exists, not scheduled |
| **Calendar Integration** | ‚ùå Missing | No Google Calendar |
| **Email Intelligence** | ‚ùå Missing | No Gmail integration |

---

## AUTONOMOUS WORK BACKLOG

### Priority 1: CRITICAL (Do First)

#### 1.1 Configure Discord Webhook [30 min]
**Why:** Enables all notification features
**Status:** Endpoint exists at /discord/webhook/send, URL not configured
**Task:**
- Add DISCORD_WEBHOOK_URL to hydra-tools-api environment
- Test notification delivery
- Enable Discord briefings

#### 1.2 Configure Home Assistant Token [15 min]
**Why:** Enables presence automation and device control
**Status:** /home/* endpoints exist, HA_TOKEN not set
**Task:**
- Create long-lived token in Home Assistant
- Add HA_TOKEN to hydra-tools-api environment
- Test /home/status endpoint

#### 1.3 Wire More Task Handlers [2 hr]
**Why:** The scheduler can run, but needs handlers for actual work
**Current Handlers:** maintenance (placeholder)
**Needed Handlers:**
- `chapter_generation` - Queue chapters for overnight processing
- `research` - Queue research topics for CrewAI
- `asset_generation` - Queue image generation tasks
- `quality_scoring` - Evaluate generated assets
**Task:** Implement handler functions that call existing endpoints

---

### Priority 2: HIGH (This Week)

#### 2.1 Quality Scoring System [4 hr]
**Why:** Critical for Empire automation - ensures generated images are acceptable
**Status:** NOT STARTED
**Task:**
- Create /quality/score endpoint using CLIP embeddings
- Compare face consistency against reference images
- Add style adherence scoring
- Create /quality/batch for bulk evaluation
- Output: score 0-100 with breakdown

#### 2.2 Complete Chapter Automation Pipeline [3 hr]
**Why:** Core feature for overnight asset generation
**Status:** 80% complete - /characters/automate-chapter exists
**Missing:**
- Progress notifications via Discord
- Asset verification after generation
- Retry logic for failures
- Morning summary report

#### 2.3 Background Generation Workflow [2 hr]
**Why:** Scenes need backgrounds, not just character portraits
**Status:** NOT STARTED
**Task:**
- Create background workflow template for ComfyUI
- Location ‚Üí style mapping for Empire settings
- Time-of-day lighting adjustments
- Integration with chapter processor

#### 2.4 Human Feedback Loop UI [3 hr]
**Why:** Learn from accept/reject decisions to improve prompts
**Status:** NOT STARTED
**Task:**
- Add review page to Command Center
- Accept/reject buttons with optional feedback
- Connect to preference learning system
- Track rejection patterns for prompt improvement

---

### Priority 3: MEDIUM (This Month)

#### 3.1 Voice Interface Testing [1 hr]
**Why:** "Hey Jarvis" is a core desired feature
**Status:** Endpoint exists, untested end-to-end
**Task:**
- Test /voice/wake/trigger-voice-chat
- Verify Wyoming OpenWakeWord integration
- Create voice ‚Üí action flows

#### 3.2 Morning Briefing System [1 hr]
**Why:** Daily summary of system status and completed work
**Status:** /discord/briefing/morning exists
**Task:**
- Schedule via n8n or scheduler
- Include: overnight work results, cluster health, alerts
- Send to Discord at 7 AM

#### 3.3 Model Hot-Swapping API [2 hr]
**Why:** Switch models without container restarts
**Status:** NOT STARTED
**Task:**
- GET /models/available - list all model files
- POST /models/load - load a model
- POST /models/unload - unload current model
- Auto-unload if VRAM insufficient

#### 3.4 Presence Automations [2 hr]
**Why:** Intelligent resource management based on user location
**Status:** Requires Home Assistant integration (blocked on HA_TOKEN)
**Task:**
- "Shaun leaves" ‚Üí GPU eco mode, queue research
- "Shaun arrives" ‚Üí restore GPU power, show status
- "Bedtime" ‚Üí full GPU power, run overnight pipeline

#### 3.5 Add Container Healthchecks [2 hr]
**Why:** 39 containers have no healthcheck
**Status:** Partially done
**Task:**
- Audit remaining containers
- Add healthcheck commands to compose files
- Implement auto-restart for failed containers

---

### Priority 4: LOW (Ongoing Improvement)

#### 4.1 Documentation Updates [Ongoing]
- Update infrastructure.md with current topology
- Document all 425 API endpoints
- Create Command Center user guide
- Add troubleshooting flowcharts

#### 4.2 Test Coverage Expansion [Ongoing]
- Integration tests for chapter pipeline
- Load tests for inference endpoints
- End-to-end tests with assertions

#### 4.3 Disk Space Management [As Needed]
- Monitor /mnt/user utilization
- Clean temp files and build caches
- Archive old session logs
- Prune unused Docker images

#### 4.4 Grafana Dashboard Improvements [2 hr]
- Add disk I/O metrics
- Add network latency between nodes
- Add inference latency histograms
- Add VRAM usage over time charts

---

## FUTURE PHASES (Vision for Next Quarter)

### Phase 13: Home Automation Deep Integration
- Google Calendar connection (meeting awareness)
- Gmail read access (important email flagging)
- Financial awareness via Plaid
- Full voice control from any room

### Phase 14: Multi-User Support
- Letta multi-agent (separate agents per user)
- Permission system (admin/standard/limited)
- User onboarding flow
- Privacy controls

### Phase 15: External Intelligence
- News aggregation (Miniflux integration)
- Proactive research based on interests
- Trading/market awareness
- Weather and commute planning

---

## WORK PROTOCOLS FOR AUTONOMOUS OPERATION

### When Scheduler Picks Up Work:
1. Check resource availability via /autonomous/resources
2. Route to appropriate node (inference ‚Üí hydra-ai, images ‚Üí hydra-compute)
3. Execute task with constitutional enforcement
4. Log to /activity
5. Send Discord notification on completion/failure
6. Extract learnings to memory

### Continuous Improvement Loop:
1. **Perceive:** Poll cluster state every 30 seconds
2. **Evaluate:** Check against configured rules
3. **Act:** Execute appropriate handler
4. **Learn:** Store outcomes, update preferences
5. **Report:** Send notifications for significant events

### Resource Thresholds (Current):
```yaml
gpu_util_max: 50%      # Only schedule if GPU util < 50%
vram_free_min_gb: 4    # Need at least 4GB VRAM free
check_interval: 30s    # Poll resources every 30 seconds
max_concurrent: 3      # Max 3 tasks running at once
```

---

## HOW TO USE THIS DOCUMENT

As the autonomous steward:
1. **Every session start:** Read this document and STATE.json
2. **Identify next task:** Pick from Priority 1, then 2, then 3
3. **Before executing:** Check if blocked on user config
4. **After completing:** Update task status, add learnings
5. **Report results:** Update STATE.json and ROADMAP.md

This is a living document. Update it as work progresses.

---

*Generated: 2025-12-18T01:35:00Z*
*Next review: After completing Priority 1 items*
