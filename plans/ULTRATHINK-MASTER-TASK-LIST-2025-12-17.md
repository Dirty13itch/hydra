# ULTRATHINK Master Task List - December 17, 2025

> Comprehensive system analysis and prioritized development roadmap for Hydra autonomous AI operating system.
> Generated by Claude Code (Opus 4.5) as permanent proactive team lead.

---

## Executive Summary

**Current System State:**
- API Version: 2.4.0 (369 endpoints across 42 routers)
- Codebase: 40,702 lines Python code
- Services: 15/15 healthy
- Containers: 69/69 running
- VRAM: 86.7GB total (64.4GB used)
- Memory: 52 memories in MIRIX 6-tier system
- Autonomous Controller: Running (12 rules active)
- Phase Completion: Phases 1-11 complete, Phase 12 at 95%

**Architecture Score: 94/100**
- Excellent: Tool integration (MCP), safety/constitution, observability
- Good: Memory architecture, self-improvement, agent orchestration
- Needs Work: External integrations, speculative decoding, production hardening

---

## Part 1: Critical Infrastructure (Priority: IMMEDIATE)

### 1.1 LiteLLM Authentication Fix
**Status:** Broken - returning 401 auth errors
**Impact:** High - unified model routing unavailable
**Tasks:**
- [ ] Verify LiteLLM API key configuration in container
- [ ] Update config/litellm/config.yaml with proper auth
- [ ] Add API key to Hydra Tools API environment
- [ ] Test model listing and routing
- [ ] Update health checks to use authenticated requests

### 1.2 Unraid GraphQL API Integration
**Status:** Broken - 400 errors on all endpoints
**Impact:** Medium - array/container management via API unavailable
**Tasks:**
- [ ] Generate Unraid API key in Unraid settings
- [ ] Configure GraphQL endpoint URL correctly
- [ ] Update /api/v1/unraid/* endpoints
- [ ] Test array status, disk info, container management
- [ ] Add to cluster health monitoring

### 1.3 TabbyAPI Context Length
**Status:** Working but max_seq_len showing null
**Impact:** Low - inference working but context not reported
**Tasks:**
- [ ] Investigate TabbyAPI model info endpoint
- [ ] Add context length to /hardware/gpus response
- [ ] Update monitoring dashboards

---

## Part 2: Phase 12 Completion - Empire of Broken Queens (Priority: HIGH)

### 2.1 Automated Quality Scoring
**Status:** Not implemented
**Impact:** High - no automated QA for generated assets
**Tasks:**
- [ ] Implement face consistency scorer using CLIP embeddings
- [ ] Create style adherence scoring against reference images
- [ ] Add technical quality checks (resolution, artifacts, noise)
- [ ] Build composite quality score (0-100)
- [ ] API endpoints: POST /quality/score-image, POST /quality/score-batch
- [ ] Integration with asset generation pipeline

### 2.2 Human Feedback Loop
**Status:** Not implemented
**Impact:** Medium - no learning from rejections
**Tasks:**
- [ ] Create accept/reject API endpoints
- [ ] Build simple review UI for Command Center
- [ ] Connect feedback to preference learning system
- [ ] Implement prompt refinement based on rejection patterns
- [ ] Add feedback history and analytics

### 2.3 End-to-End Chapter Automation
**Status:** 80% complete (needs orchestration)
**Impact:** High - milestone for Phase 12
**Tasks:**
- [ ] Create unified chapter processing endpoint
- [ ] Implement job queuing with status tracking
- [ ] Add progress notifications (Discord/email)
- [ ] Build asset verification post-generation
- [ ] Create morning summary report of overnight work
- [ ] Implement retry logic for failed generations

### 2.4 Background Generation Integration
**Status:** Workflow exists, not integrated with pipeline
**Tasks:**
- [ ] Wire background generation to chapter processor
- [ ] Add location → style mapping for Empire settings
- [ ] Implement time-of-day lighting adjustments
- [ ] Test batch background generation
- [ ] Add backgrounds to packaging

---

## Part 3: Home Automation Integration (Priority: MEDIUM-HIGH)

### 3.1 Home Assistant Connection
**Status:** Not configured (no HA_TOKEN)
**Impact:** Required for Phase 13
**Tasks:**
- [ ] Create Home Assistant long-lived access token
- [ ] Configure HA_TOKEN in Hydra environment
- [ ] Test /home/status endpoint
- [ ] Implement device discovery
- [ ] Create entity state sync to Qdrant
- [ ] Add real-time event subscription (WebSocket)

### 3.2 Device Onboarding
**Status:** Not started
**Tasks:**
- [ ] Lutron Caseta integration (lights)
- [ ] Bond Bridge integration (fans, shades)
- [ ] Nest thermostat status
- [ ] Ring presence detection
- [ ] Create unified device control API

### 3.3 Presence Automation
**Status:** Stub implemented, not functional
**Tasks:**
- [ ] Wire presence detection to actual sensors
- [ ] Implement "Shaun leaves" automation
- [ ] Implement "Shaun arrives" automation
- [ ] GPU eco mode when away
- [ ] Morning briefing preparation

---

## Part 4: Communication Integrations (Priority: MEDIUM)

### 4.1 Discord Integration
**Status:** Endpoints exist, not configured
**Tasks:**
- [ ] Create Discord application and bot
- [ ] Generate webhook URL for notifications
- [ ] Configure DISCORD_WEBHOOK_URL in environment
- [ ] Test alert notifications
- [ ] Implement slash commands (/status, /health, /benchmark)
- [ ] Add interaction webhook handler

### 4.2 Notification System
**Status:** Partial (alerts go to Alertmanager)
**Tasks:**
- [ ] Create unified notification service
- [ ] Support Discord, email, push notifications
- [ ] Add notification preferences per alert type
- [ ] Implement notification history
- [ ] Add quiet hours configuration

### 4.3 Morning Briefing
**Status:** Not implemented
**Tasks:**
- [ ] Aggregate overnight events
- [ ] Summarize completed autonomous work
- [ ] Include cluster health summary
- [ ] Add calendar events for the day
- [ ] Generate and deliver at configurable time

---

## Part 5: Calendar & External Intelligence (Priority: MEDIUM)

### 5.1 Google Calendar Integration
**Status:** Stub only - no OAuth
**Tasks:**
- [ ] Implement Google OAuth2 flow
- [ ] Create calendar sync service
- [ ] Store events in Qdrant for context
- [ ] Add schedule-aware task planning
- [ ] Block inference during meetings

### 5.2 Email Intelligence (Gmail)
**Status:** Not started
**Tasks:**
- [ ] Implement Gmail read-only OAuth
- [ ] Create important email flagging rules
- [ ] Thread summarization with LLM
- [ ] Add to morning briefing
- [ ] Privacy controls (opt-in per sender)

### 5.3 Financial Awareness
**Status:** Not started
**Tasks:**
- [ ] Research Plaid vs direct bank APIs
- [ ] Implement portfolio tracking
- [ ] Daily balance/change summaries
- [ ] Alert on significant changes
- [ ] Add to morning briefing

---

## Part 6: Inference Optimization (Priority: MEDIUM-HIGH)

### 6.1 Speculative Decoding Deployment
**Status:** Research complete, not deployed
**Expected Impact:** 2-4x inference speedup
**Tasks:**
- [ ] Configure TabbyAPI with speculative decoding enabled
- [ ] Deploy draft model on RTX 4090 (8B model)
- [ ] Keep main 70B model on RTX 5090
- [ ] Benchmark before/after latency
- [ ] Monitor acceptance rate
- [ ] Tune draft model selection

### 6.2 RouteLLM Enhancement
**Status:** Basic implementation exists
**Tasks:**
- [ ] Improve prompt complexity classifier
- [ ] Add task-specific routing (code → codestral, creative → 70B)
- [ ] Implement cost tracking
- [ ] Add latency-based routing
- [ ] Create routing analytics dashboard

### 6.3 Context Caching
**Status:** Not implemented
**Tasks:**
- [ ] Implement prompt caching for repeated contexts
- [ ] Add system prompt caching
- [ ] Configure Redis for cache storage
- [ ] Monitor cache hit rates
- [ ] Optimize cache eviction policy

---

## Part 7: Memory Architecture Enhancement (Priority: MEDIUM)

### 7.1 Graphiti/Neo4j Integration
**Status:** Neo4j running, Graphiti not deployed
**Expected Impact:** 18.5% accuracy boost per research
**Tasks:**
- [ ] Deploy Graphiti as memory enhancement layer
- [ ] Configure Neo4j connection
- [ ] Build entity extraction pipeline
- [ ] Create relationship mapping
- [ ] Enable temporal queries
- [ ] Hybrid search (vector + graph + keyword)

### 7.2 Skill Learning System
**Status:** Stub exists, not functional
**Tasks:**
- [ ] Implement automatic skill extraction after task completion
- [ ] Create skill library in Qdrant
- [ ] Enable skill retrieval for similar tasks
- [ ] Build skill refinement from feedback
- [ ] Add skill analytics

### 7.3 Memory Consolidation
**Status:** Not implemented
**Tasks:**
- [ ] Implement nightly memory consolidation job
- [ ] Merge duplicate/similar memories
- [ ] Archive old working memories
- [ ] Prune low-value memories
- [ ] Generate consolidated summaries

---

## Part 8: Multi-Agent Orchestration (Priority: MEDIUM)

### 8.1 LangGraph Migration Evaluation
**Status:** Research says 2.2x faster than CrewAI
**Tasks:**
- [ ] Create proof-of-concept LangGraph crew
- [ ] Benchmark against existing CrewAI crews
- [ ] Evaluate migration effort
- [ ] Decision: migrate or keep CrewAI
- [ ] If migrating: create migration plan

### 8.2 Agent Handoff Protocol
**Status:** Basic scheduling exists
**Tasks:**
- [ ] Implement context passing between agents
- [ ] Create handoff verification
- [ ] Add failure recovery for handoffs
- [ ] Build handoff history
- [ ] Optimize context compression

### 8.3 Agent Resource Isolation
**Status:** Basic AIOS scheduling implemented
**Tasks:**
- [ ] Implement per-agent VRAM limits
- [ ] Add CPU/memory quotas
- [ ] Create agent priority levels
- [ ] Implement preemption for high-priority tasks
- [ ] Add resource usage analytics

---

## Part 9: Security & Sandboxing (Priority: HIGH)

### 9.1 E2B/Firecracker Production Deploy
**Status:** Research complete, not in production
**Tasks:**
- [ ] Deploy E2B sandbox service
- [ ] Create Firecracker VM templates
- [ ] Configure network isolation
- [ ] Add filesystem restrictions
- [ ] Implement resource limits
- [ ] Build sandbox usage API

### 9.2 Secrets Management
**Status:** Basic env vars
**Tasks:**
- [ ] Evaluate SOPS vs Vault vs Infisical
- [ ] Implement secrets rotation
- [ ] Add audit logging for secret access
- [ ] Migrate all hardcoded secrets
- [ ] Create secret injection for containers

### 9.3 API Authentication
**Status:** No auth on most endpoints
**Tasks:**
- [ ] Implement API key authentication
- [ ] Add rate limiting per client
- [ ] Create admin vs user roles
- [ ] Add JWT support for sessions
- [ ] Build API key management UI

---

## Part 10: Observability Enhancement (Priority: MEDIUM)

### 10.1 Grafana Dashboard Completion
**Status:** Basic dashboards exist
**Tasks:**
- [ ] Create inference latency dashboard
- [ ] Build agent execution dashboard
- [ ] Add memory system dashboard
- [ ] Create Empire asset generation dashboard
- [ ] Implement alerting dashboards

### 10.2 Logging Enhancement
**Status:** Loki deployed, basic logging
**Tasks:**
- [ ] Add structured logging across all modules
- [ ] Implement log correlation IDs
- [ ] Create log-based alerting
- [ ] Build log search UI in Command Center
- [ ] Add log retention policies

### 10.3 Tracing Implementation
**Status:** Not implemented
**Tasks:**
- [ ] Deploy Jaeger or Tempo
- [ ] Instrument API requests
- [ ] Trace agent execution flows
- [ ] Add trace correlation to logs
- [ ] Build trace visualization

---

## Part 11: Testing & Quality (Priority: HIGH)

### 11.1 Fix Test Suite
**Status:** 154/201 passing (76%)
**Root Causes:** Model config mismatches, API endpoint changes
**Tasks:**
- [ ] Fix 26 failing tests (model config)
- [ ] Fix 21 test errors (API changes)
- [ ] Add missing test coverage for new routers
- [ ] Create integration test suite
- [ ] Set up CI/CD test pipeline

### 11.2 Load Testing
**Status:** Not implemented
**Tasks:**
- [ ] Create load test scenarios
- [ ] Test inference under load
- [ ] Test API rate limits
- [ ] Identify bottlenecks
- [ ] Document performance baselines

### 11.3 Chaos Testing
**Status:** Not implemented
**Tasks:**
- [ ] Implement service failure scenarios
- [ ] Test container restart recovery
- [ ] Test database failover
- [ ] Test network partition handling
- [ ] Document recovery procedures

---

## Part 12: Documentation & Developer Experience (Priority: LOW-MEDIUM)

### 12.1 API Documentation
**Status:** Auto-generated OpenAPI
**Tasks:**
- [ ] Add detailed endpoint descriptions
- [ ] Create usage examples
- [ ] Document authentication
- [ ] Add response schemas
- [ ] Generate client SDKs

### 12.2 Architecture Documentation
**Status:** Various docs exist, not consolidated
**Tasks:**
- [ ] Create consolidated architecture diagram
- [ ] Document data flows
- [ ] Document deployment procedures
- [ ] Create troubleshooting guide
- [ ] Build runbook for common operations

### 12.3 Knowledge File Cleanup
**Status:** Some outdated info
**Tasks:**
- [ ] Audit knowledge/*.md for accuracy
- [ ] Update IP addresses and endpoints
- [ ] Add new system components
- [ ] Create knowledge refresh automation
- [ ] Archive deprecated content

---

## Part 13: Command Center UI (Priority: MEDIUM)

### 13.1 Complete Dashboard Features
**Status:** Basic functionality working
**Tasks:**
- [ ] Fix any remaining React context issues
- [ ] Add service action buttons (restart, logs)
- [ ] Implement task queue visualization
- [ ] Create agent status panel
- [ ] Add memory browser

### 13.2 Empire Asset Browser
**Status:** Not implemented
**Tasks:**
- [ ] Create character gallery view
- [ ] Build asset generation queue viewer
- [ ] Add chapter progress tracker
- [ ] Implement asset review/approve UI
- [ ] Create export manager

### 13.3 Voice Interface UI
**Status:** WebSocket exists, no UI
**Tasks:**
- [ ] Create voice input button
- [ ] Add transcription display
- [ ] Show voice synthesis progress
- [ ] Implement push-to-talk
- [ ] Add voice history

---

## Part 14: Continuous Improvement (Priority: ONGOING)

### 14.1 Self-Improvement Cycle Activation
**Status:** DGM cycle implemented, needs activation
**Tasks:**
- [ ] Schedule daily self-improvement runs
- [ ] Configure benchmark thresholds
- [ ] Enable automatic PR creation for improvements
- [ ] Set up human approval workflow
- [ ] Monitor improvement metrics

### 14.2 Autonomous Research
**Status:** Research crew exists
**Tasks:**
- [ ] Configure research topics queue
- [ ] Schedule nightly research runs
- [ ] Build research result summarization
- [ ] Add to morning briefing
- [ ] Create research archive

### 14.3 Capability Gap Detection
**Status:** Capability tracker exists
**Tasks:**
- [ ] Enable automatic gap detection
- [ ] Prioritize gaps by frequency/impact
- [ ] Generate implementation suggestions
- [ ] Track gap resolution
- [ ] Report metrics weekly

---

## Prioritized Execution Order

### Week 1: Critical Fixes
1. LiteLLM authentication fix
2. Test suite fixes (get to 90%+)
3. Home Assistant token configuration
4. Discord webhook setup

### Week 2: Phase 12 Completion
5. Automated quality scoring
6. End-to-end chapter automation
7. Background generation integration
8. Human feedback loop (basic)

### Week 3: Inference & Memory
9. Speculative decoding deployment
10. Graphiti/Neo4j integration
11. Context caching implementation
12. Memory consolidation

### Week 4: Integration & Polish
13. Presence automation activation
14. Morning briefing implementation
15. Dashboard completion
16. API authentication

### Ongoing
- Self-improvement cycle monitoring
- Autonomous research runs
- Documentation updates
- Test coverage expansion

---

## Success Metrics

| Metric | Current | Target | Timeline |
|--------|---------|--------|----------|
| API Endpoints | 369 | 400+ | 2 weeks |
| Test Pass Rate | 76% | 95% | 1 week |
| Inference Latency | ~2s | ~0.8s | 3 weeks |
| Memory Accuracy | 85% | 95% | 4 weeks |
| Autonomous Actions/Day | ~0 | 10+ | 2 weeks |
| Phase 12 Complete | 95% | 100% | 1 week |
| Phase 13 Complete | 0% | 50% | 4 weeks |

---

## Constitutional Reminders

All work must comply with immutable constraints:
- Never delete databases without human approval
- Never modify network/firewall configuration
- Never disable authentication systems
- Never expose secrets or credentials
- Never push to main branch without human approval
- Always maintain audit trail
- Always sandbox code execution

---

*Generated: 2025-12-17T17:45:00Z*
*Next Review: 2025-12-24*
*Document Owner: Claude Code (Opus 4.5) - Permanent Proactive Team Lead*
